#!/usr/bin/env python3
"""Configuration script for importing new transactions.

This is the configuration... which is actually the script itself.
You run this script on your Downloads directory, and it should
automatically identify which files it is able to import and spit
out the transactions in a format you can just insert in your
Beancount file.
"""
# We import the main function that runs the import script.
from ledgerhub.scripts.run import main

# Then we import some source modules. See beancount.sources for
# more supported input sources... You'll probably have to write
# some for your own banks where necessary; these can be contributed
# back to Beancount for others to use, or you can just import them
# from your own personal code.
from ledgerhub.importers.generic import ofx


# Here we declare the configuration input, which is a list of (regexp,
# importer-object) pairs. The importer creates a matching text which this the
# regular expressions are matched against in order to automate identifying which
# importer has to be run on it. The list of regexp's must *all* match against
# contents in the input files.
#
# You provide an importer object configured with the list of accounts it needs
# to generate directives to.
#
# The matching text is formatted with this template, which you provide regu
#
#    Filename: <the name of the file>
#    FileType: <auto-detected mime type of the file>
#    Contents: <contents of the file, converted if necessary>
#
# Note that for the purpose of matching, the contents of PDF files are
# automatically converted to ASCII, and, binary/Excel spreadsheet files are
# converted to CSV format. When creating your importer configuration (this
# file), matching text can be viewed by calling the importer (this script) with
# the --debug option. Look at the matching text provided for each file and you
# must craft a list of regular expressions that uniquely identify which account
# the file belongs to.

CONFIG = [

    # Configuration for importing American Express.
    #
    # This company's website provides transaction information in multiple
    # formats. This importer supports the MS Money OFX format.
    (('FileType: application/.*fx',
      r'Contents:.*<ACCTID>379700001111222'),
     ofx.Importer({
         'FILE'  : 'Liabilities:US:Amex:BlueCash',
         'asset' : 'Liabilities:US:Amex:BlueCash',
         'acctid': '379700001111222',
     })),

    # Add more importers here... the importer main function will try them all
    # out and run all the importers that match the regexps.
]

ledger_file = __file__.replace(".import", ".beancount")
main(CONFIG, ledger_file)
